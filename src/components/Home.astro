---
import { Button } from "./ui/button";
import NameInput from "./NameInput";
---

<div class="min-h-screen bg-white flex flex-col items-center justify-center p-4 relative">
  <div class="text-center my-10">
    <h1 class="text-2xl text-black mb-2">Korepetytor AI</h1>
    <p class="text-sm text-gray-500">Pomoc dla uczni贸w lice贸w i technik贸w</p>
  </div>

  <NameInput client:load />

  <!-- Content that should be inert when modal is open -->
  <div id="home-content" class="hidden flex-col items-center justify-center">
    <!-- Welcome text centered -->
    <div class="text-center my-10">
      <h1 class="text-2xl text-black mb-2">Witaj, <span id="name-display"></span>!</h1>
    </div>

    <div class="mb-6">
      <a href="/tutors" class="inline-block">
        <Button variant="ok"> Zaczynamy </Button>
      </a>
    </div>

    <div>
      <a href="/history" class="inline-block">
        <Button variant="back"> Historia rozm贸w </Button>
      </a>
    </div>
  </div>
</div>

<script>
  /* eslint-disable prettier/prettier */

  // Function to show welcome section when name is available
  const showWelcomeSection = (userName: string) => {
    const nameDisplay = document.getElementById("name-display");
    const homeContent = document.getElementById("home-content");

    if (nameDisplay) {
      nameDisplay.textContent = userName;
    }
    if (homeContent) {
      homeContent.classList.remove("hidden");
      homeContent.classList.add("flex", "flex-col");
    }
  };

  // Function to initialize home page
  const initHome = () => {
    const storedName = localStorage.getItem("userName");

    // Check if name exists on page load
    if (storedName) {
      showWelcomeSection(storedName);
    }
  };

  // Run on initial load
  initHome();

  // Re-run after View Transitions navigation
  document.addEventListener("astro:page-load", initHome);

  // Listen for name updates from NameInput component
  window.addEventListener("nameUpdated", (event) => {
    const customEvent = event as CustomEvent;
    if (customEvent.detail?.name) {
      showWelcomeSection(customEvent.detail.name);
    }
  });

  // Listen for modal state changes to set inert attribute
  window.addEventListener("nameInputModalState", (event) => {
    const customEvent = event as CustomEvent;
    const homeContent = document.getElementById("home-content");
    if (homeContent && customEvent.detail) {
      if (customEvent.detail.isOpen) {
        homeContent.setAttribute("inert", "");
      } else {
        homeContent.removeAttribute("inert");
      }
    }
  });
</script>
