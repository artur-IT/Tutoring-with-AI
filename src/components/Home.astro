---
import NameInput from "./NameInput";
---

<div
  class="min-h-screen bg-gradient-to-br from-background via-background to-accent/5 flex flex-col items-center justify-center p-4 relative overflow-hidden"
>
  <!-- Decorative background elements -->
  <div class="absolute inset-0 -z-10 overflow-hidden">
    <div class="absolute top-20 right-10 w-64 h-64 bg-primary/5 rounded-full blur-3xl"></div>
    <div class="absolute bottom-20 left-10 w-80 h-80 bg-accent/10 rounded-full blur-3xl"></div>
  </div>

  <div class="text-center my-12 animate-in fade-in slide-in-from-bottom-4 duration-700">
    <div class="mb-4 text-5xl animate-[wiggle_2s_ease-in-out_infinite]">ğŸ“</div>
    <h1 class="text-4xl md:text-5xl font-black text-foreground mb-4 tracking-tight">
      Korepetytor <span class="text-primary">AI</span>
    </h1>
    <p class="text-lg md:text-xl text-muted-foreground font-medium">Pomoc dla uczniÃ³w liceÃ³w i technikÃ³w</p>
  </div>

  <NameInput client:idle />

  <!-- Content that should be inert when modal is open -->
  <div id="home-content" class="hidden flex-col items-center justify-center">
    <!-- Welcome text centered -->
    <div class="text-center my-12 animate-in fade-in slide-in-from-bottom-4 duration-700 delay-150">
      <div class="mb-4 text-4xl">ğŸ‘‹</div>
      <h2 class="text-3xl md:text-4xl font-black text-foreground mb-6">
        Witaj <span id="name-display" aria-live="polite" class="text-primary"></span>!
      </h2>
      <p class="text-lg md:text-xl text-muted-foreground font-medium mb-8">Gotowy na naukÄ™? Wybierz przedmiot!</p>
    </div>

    <div class="flex flex-col gap-4 items-center animate-in fade-in slide-in-from-bottom-4 duration-700 delay-300">
      <a
        href="/tutors"
        class="w-56 inline-flex items-center cursor-pointer justify-center gap-3 whitespace-nowrap rounded-2xl text-lg font-bold transition-all focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 px-6 py-3 bg-primary text-primary-foreground hover:bg-primary/90 hover:-translate-y-1 shadow-lg hover:shadow-xl active:scale-95"
      >
        <span class="text-2xl">ğŸš€</span>
        Rozpocznij naukÄ™
      </a>

      <a
        href="/history-list"
        class="w-56 inline-flex items-center cursor-pointer justify-center gap-3 whitespace-nowrap rounded-2xl text-base font-semibold transition-all focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 px-6 py-3 bg-background text-primary hover:bg-muted border-2 border-primary shadow-sm hover:shadow-md active:scale-95"
      >
        <span class="text-xl">ğŸ“š</span>
        Twoje rozmowy
      </a>
    </div>
  </div>
</div>

<script>
  /* eslint-disable prettier/prettier */

  // Function to show welcome section when name is available
  const showWelcomeSection = (userName: string) => {
    const nameDisplay = document.getElementById("name-display");
    const homeContent = document.getElementById("home-content");

    if (nameDisplay) {
      nameDisplay.textContent = userName;
    }
    if (homeContent) {
      homeContent.classList.remove("hidden");
      homeContent.classList.add("flex", "flex-col");
    }
  };

  // Function to initialize home page
  const initHome = () => {
    const storedName = localStorage.getItem("userName");

    // Check if name exists on page load
    if (storedName) {
      showWelcomeSection(storedName);
    }
  };

  const runWhenIdle = (callback) => {
    if ("requestIdleCallback" in window) {
      window.requestIdleCallback(callback, { timeout: 2000 });
      return;
    }
    setTimeout(callback, 1);
  };

  // Run on initial load (defer to idle to reduce main-thread work)
  runWhenIdle(initHome);

  // Re-run after View Transitions navigation
  document.addEventListener("astro:page-load", () => runWhenIdle(initHome));

  // Listen for name updates from NameInput component
  window.addEventListener("nameUpdated", (event) => {
    const customEvent = event as CustomEvent;
    if (customEvent.detail?.name) {
      showWelcomeSection(customEvent.detail.name);
    }
  });

  // Listen for modal state changes to set inert attribute
  window.addEventListener("nameInputModalState", (event) => {
    const customEvent = event as CustomEvent;
    const homeContent = document.getElementById("home-content");
    if (homeContent && customEvent.detail) {
      if (customEvent.detail.isOpen) {
        homeContent.setAttribute("inert", "");
      } else {
        homeContent.removeAttribute("inert");
      }
    }
  });
</script>
